from Models import *
from Dao import *
from novovarejo import *
from github import Github
from flask import jsonify, Flask, render_template, send_file, make_response, url_for, Response, redirect, request
from datetime import datetime
import json
import requests

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('homepage.html', PageTitle='Landing Page')


access_token = "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"
g = Github(access_token)

def filtroData( dataInicio1, dataTermino1):     #criação do repo
    access_token = "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"
    g = Github(access_token)

    dataInicio1 = datetime.strptime(dataInicio1, '%d/%m/%Y').date()
    dataTermino1 = datetime.strptime(dataTermino1, '%d/%m/%Y').date()
    repos = [_ for _ in g.get_user().get_repos()]
    for repo in repos:
        x = repo.created_at
        y = datetime.date(x)
        if dataInicio1 < y and dataTermino1 > y:
            print(str(repo))
            return str(repo)
        elif dataInicio1 > y and dataTermino1 < y:
            print('Não há repositórios publicados neste período' )
            return 'Não há repositórios publicados neste período'

@app.route('/handle_data', methods=['POST'])
def handle_data():

    projectpath = request.form['date']
    data1 = projectpath[1:11]
    data2 = projectpath[15:25]
    return str(filtroData(data1, data2))






if __name__ == '__main__':
    app.run(debug=True)
